---
title: "RprojectScript"
output:
  html_document: default
  pdf_document: default
date: "2023-07-31"
---

## Setup libraries and folders

```{r setup, include=FALSE}
# Remove  all objects from R memory 
rm(list=ls())  

# Set a path to the library containing packages
.libPaths("C:/Computerteknologi/10_semester/Rcourse")
.libPaths()


# Load selected packages# 
pack<-c("car","sandwich","lmtest","RColorBrewer","mgcv","foreign","xtable"
        ,"AER","stargazer", "MASS")

lapply(pack, require, character.only=T)

# Check the working path
getwd()

# Specify  paths
getwd()

# Set working path
data_path<-"C:/Computerteknologi/10_semester/Rcourse/project/data"
data_graph <-"C:/Computerteknologi/10_semester/Rcourse/project/graph"
data_results <-"C:/Computerteknologi/10_semester/Rcourse/project/result"
data_scripts <-"C:/Computerteknologi/10_semester/Rcourse/project/script"
setwd(data_path)

#Check the directory
dir()

data = read.csv("mortality2.csv",header = FALSE,skip = 0)


```

## Preprocessing of data

```{r}

data_countries = data[!grepl("exclud",data$V1),]
data_countries = data[!grepl("income",data$V1),]
data_countries2 = data

data_income = data[grepl("income",data$V1),]
data2 = data_countries2[-(1:3),-1]



rownames(data2) = data_countries2[-(1:3),1]
colnames(data2) = data_countries2[3,-(1:1)] 


data2 = data2[,-4:-33]
data2 = data2[,-35:-37]
data2 = data2[rowSums(is.na(data2))<5,]

data3 = data_countries[-(1:3),-1]



rownames(data3) = data_countries[-(1:3),1]
colnames(data3) = data_countries[3,-(1:1)] 


data3 = data3[,-4:-33]
data3 = data3[,-35:-37]
data3 = data3[rowSums(is.na(data3))<5,]

subset(data2,)

continentCodes = c("EAP","ECA","LAC","MNA","SSA","EAS","ECS","LCN","MEA","SSF")
continents = data2[data2$`Country Code` %in% continentCodes,]
#data2 = data[,-4:-33]

```

Webscraping webpage to get areas, unions and continents out

```{r}
#Loading the rvest package
library('rvest')

#Specifying the url for desired website to be scraped
url <- 'https://www.iban.com/country-codes'


#Reading the HTML code from the website
webpage <- read_html(url)

drivers_F1 <- html_element(webpage, "table.table") %>%
  html_table()

sum1 = sum(data2$`Country Code` %in% drivers_F1$`Alpha-3 code`)
#webpage %>% html_elements("table#Country-Codes-A-C")
#drivers_F1$Country

data3=data2[!data2$`Country Code` %in% drivers_F1$`Alpha-3 code`,]
data3=data3[data3$`Country Code`!="XKX",]

data_categories=data3
data_countries = data2[data2$`Country Code` %in% drivers_F1$`Alpha-3 code`,]
```

HDI list:

```{r}
#Loading the rvest package
library('rvest')

#Specifying the url for desired website to be scraped
url <- 'https://en.wikipedia.org/wiki/List_of_countries_by_Human_Development_Index'


#Reading the HTML code from the website
webpage <- read_html(url)

drivers_F1 <- html_element(webpage, "table.sortable") %>%
  html_table()

hdi_list = drivers_F1[,c("Rank","Nation")]
hdi_list = hdi_list[-1,]
#webpage %>% html_elements("table#Country-Codes-A-C")
#drivers_F1$Country
#data3=data2[!data2$`Country Code` %in% drivers_F1$`Alpha-3 code`,]
#data3=data3[data3$`Country Code`!="XKX",]

#data_categories=data3
```

## Analytics of data

-   Connection between immortality and HDI

-   Developing over time

-   Countries from lowest to highest immortality

-   Categories of countries

-   Comparison of Low / medium / high income countries with

plots:

-   Map with the locations of the world countries'

```{r}
immortal1990 = data_countries[,4]
immortal2020 = data_countries[,34]

barplot(sort(immortal1990))
barplot(sort(immortal2020))
df = data.frame(rownames(data_countries),immortal1990,immortal2020)
#barplot(df, col = c("#993404", "#FB6A4A"),height=immortal1990)

#library(ggplot2)
#ggplot(df) +
#  aes(x = df$rownames.data_countries.) +
#  geom_col(aes(y = df$immortal1990, fill = "total"))+
#  geom_col(aes(y = df$immortal2020, fill = "ui"))+
#  labs(x=NULL, y = "Number of papers") +
#  scale_fill_manual(values = c(immortal1990 = "grey", immortal2020 = #"dodgerblue4")) +
#  theme_bw()+
#  theme(panel.border = element_blank(), panel.grid.major = #element_blank(),
#        panel.grid.minor = element_blank(), axis.line = element_line#(colour = "black"))
library(grid)
library(gridBase)

#1990
sortedImmortal=df[order(df$immortal1990),]
headAndTail= head(sortedImmortal,5)
headAndTail = rbind(headAndTail,tail(sortedImmortal,5))

midpts = barplot(headAndTail$immortal1990,ylim = c(0,180))

vps <- baseViewports()
pushViewport(vps$inner, vps$figure, vps$plot)

grid.text(headAndTail$rownames.data_countries.,
    x = unit(midpts, "native"), y=unit(-2, "lines"),
    just="right", rot=50)

#2020
sortedImmortal=df[order(df$immortal2020),]
headAndTail= head(sortedImmortal,5)
headAndTail = rbind(headAndTail,tail(sortedImmortal,5))

midpts = barplot(headAndTail$immortal2020,ylim = c(0,180))

vps <- baseViewports()
pushViewport(vps$inner, vps$figure, vps$plot)

grid.text(headAndTail$rownames.data_countries.,
    x = unit(midpts, "native"), y=unit(-2, "lines"),
    just="right", rot=50)

```

Connection between HDI and immortality

```{r}
matchHdiList = hdi_list[hdi_list$Nation %in% rownames(data_countries),]
matchDatacountries = data_countries[rownames(data_countries) %in% hdi_list$Nation,]


matchHdiList = matchHdiList[order(matchHdiList$Nation),]
matchDatacountries = matchDatacountries[order(rownames(matchDatacountries)),]

plot(matchHdiList$Rank,matchDatacountries[,34],xlab = "Countries' HDI ranking (1 = highest human development)",ylab = "Mortality rate, infant (per 1,000 live births)")
```

World maps plots:

```{r}
library(rworldmap)


#populationData = data.frame()
joinData <- joinCountryData2Map( sortedImmortal,
                                 joinCode = "NAME",
                                 nameJoinColumn = "rownames.data_countries.")
theMap1990 <- mapCountryData( joinData, nameColumnToPlot="immortal1990", addLegend=TRUE,catMethod = seq(1, 180, len = 20))
theMap2020 <- mapCountryData( joinData, nameColumnToPlot="immortal2020", addLegend=TRUE,catMethod = seq(1, 180, len = 20))
#do.call( addMapLegend, c(theMap1990, legendWidth=1, legendMar = 2))


#do.call( addMapLegend, c(theMap2020, legendWidth=1, legendMar = 2))
```
